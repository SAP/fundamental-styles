@use "sass:map";

@import "./new-settings";
@import "./mixins";
@import "./mixins/button/button-helper";

$block: #{$fd-namespace}-shellbar;
$select: #{$fd-namespace}-select;

.#{$block} {
  // Brand
  $fd-shellbar-logo-background-image-url: "data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MTIuMzggMjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xLC5jbHMtMntmaWxsLXJ1bGU6ZXZlbm9kZH0uY2xzLTF7ZmlsbDp1cmwoI2xpbmVhci1ncmFkaWVudCl9LmNscy0ye2ZpbGw6I2ZmZn08L3N0eWxlPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZWFyLWdyYWRpZW50IiB4MT0iMjA2LjE5IiB4Mj0iMjA2LjE5IiB5Mj0iMjA0IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMDBiOGYxIi8+PHN0b3Agb2Zmc2V0PSIuMDIiIHN0b3AtY29sb3I9IiMwMWI2ZjAiLz48c3RvcCBvZmZzZXQ9Ii4zMSIgc3RvcC1jb2xvcj0iIzBkOTBkOSIvPjxzdG9wIG9mZnNldD0iLjU4IiBzdG9wLWNvbG9yPSIjMTc3NWM4Ii8+PHN0b3Agb2Zmc2V0PSIuODIiIHN0b3AtY29sb3I9IiMxYzY1YmYiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMxZTVmYmIiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48dGl0bGU+U0FQX2dyYWRfUl9zY3JuX1plaWNoZW5mbMOkY2hlIDE8L3RpdGxlPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTAgMjA0aDIwOC40MUw0MTIuMzggMEgwdjIwNCIvPjxwYXRoIGNsYXNzPSJjbHMtMiIgZD0iTTI0NC43MyAzOC4zNmgtNDAuNnY5Ni41MmwtMzUuNDYtOTYuNTVoLTM1LjE2bC0zMC4yNyA4MC43MkMxMDAgOTguNyA3OSA5MS42NyA2Mi40IDg2LjQgNTEuNDYgODIuODkgMzkuODUgNzcuNzIgNDAgNzJjLjA5LTQuNjggNi4yMy05IDE4LjM4LTguMzggOC4xNy40MyAxNS4zNyAxLjA5IDI5LjcxIDhsMTQuMS0yNC41NUM4OS4wNiA0MC40MiA3MSAzNi4yMSA1Ni4xNyAzNi4xOWgtLjA5Yy0xNy4yOCAwLTMxLjY4IDUuNi00MC42IDE0LjgzQTM0LjIzIDM0LjIzIDAgMCAwIDUuNzcgNzQuN0M1LjU0IDg3LjE1IDEwLjExIDk2IDE5LjcxIDEwM2M4LjEgNS45NCAxOC40NiA5Ljc5IDI3LjYgMTIuNjIgMTEuMjcgMy40OSAyMC40NyA2LjUzIDIwLjM2IDEzQTkuNTcgOS41NyAwIDAgMSA2NSAxMzVjLTIuODEgMi45LTcuMTMgNC0xMy4wOSA0LjEtMTEuNDkuMjQtMjAtMS41Ni0zMy42MS05LjU5TDUuNzcgMTU0LjQyYTkzLjc3IDkzLjc3IDAgMCAwIDQ2IDEyLjIyaDIuMTFjMTQuMjQtLjI1IDI1Ljc0LTQuMzEgMzQuOTItMTEuNzEuNTMtLjQxIDEtLjg0IDEuNDktMS4yOGwtNC4xMiAxMC44NUgxMjNsNi4xOS0xOC44MmE2Ny40NiA2Ny40NiAwIDAgMCAyMS42OCAzLjQzIDY4LjMzIDY4LjMzIDAgMCAwIDIxLjE2LTMuMjVsNiAxOC42NGg2MC4xNHYtMzloMTMuMTFjMzEuNzEgMCA1MC40Ni0xNi4xNSA1MC40Ni00My4yIDAtMzAuMTEtMTguMjItNDMuOTQtNTcuMDEtNDMuOTR6TTE1MC45MSAxMjFhMzYuOTMgMzYuOTMgMCAwIDEtMTMtMi4yOGwxMi44Ny00MC41OWguMjJsMTIuNjUgNDAuNzFhMzguNSAzOC41IDAgMCAxLTEyLjc0IDIuMTZ6bTk2LjItMjMuMzNoLTguOTRWNjQuOTFoOC45NGMxMS45MyAwIDIxLjQ0IDQgMjEuNDQgMTYuMTQgMCAxMi42LTkuNTEgMTYuNTctMjEuNDQgMTYuNTciLz48L3N2Zz4=" !default;

  @mixin fd-shellbar-sm-screen() {
    --fdSelect_Text_Content_Display: none;
    --fdSelect_Min_Width: 1rem;
    .#{$block}__subtitle,
    .#{$block}__title {
      display: none;
    }

    .#{$block}__group {
      &--mobile-flex {
        @include fd-flex-center();
      }
    }

    .#{$block}__action {
      &--mobile {
        display: inline-block;
      }

      &--desktop {
        display: none;
      }

      &:has(.#{$block}__search-field) {
        width: 100%;
      }
    }

    .#{$block}__action-combobox {
      &--mobile {
        @include fd-flex-center();

        background-color: var(--sapShellColor);
        width: 100%;
        height: 100%;
        z-index: 7;
        position: absolute;
        left: 0;
        margin-inline: 0;
        margin-block: 0;
        padding-block: 0;
        padding-inline: 0.3rem;
      }
    }

    .#{$block}__button--menu {
      @include fd-icon-selector() {
        margin-inline: 0 !important;
        margin-block: 0 !important;
      }
    }

    .#{$block}__search-field {
      width: 100%;
    }
  }

  @mixin fd-shellbar-md-lg-xl-screens() {
    .#{$block}__subtitle,
    .#{$block}__title {
      display: inline-block;
    }

    .#{$block}__action {
      &--mobile {
        display: none;
      }

      &--desktop {
        display: inline-block;
      }
    }
  }

  @include fd-reset();

  @include fd-flex-vertical-center () {
    gap: 1rem;
    justify-content: space-between;
  }

  height: 3.25rem; 
  padding-block: 0;
  background: var(--sapShellColor);
  box-shadow: var(--sapShell_Shadow); 
  padding-inline: var(--fdShellbar_Inline_Padding, 1rem);
  border: inset 0 -0.0625rem 0 0 var(--sapShell_BorderColor);

  &__branding {
    @include fd-reset();

    @include fd-flex-vertical-center () {
      gap: 0.25rem;
    }

    height: 2.25rem;
    padding-block: 0.125rem;
    border-radius: 0.375rem;
    padding-inline: 0.25rem 0.5rem;
    cursor: var(--fdShellBar_Branding_Cursor, pointer);
    background: var(--fdShellBar_Branding_Background, var(--sapButton_Lite_Background));
    border: var(--sapButton_BorderWidth) solid var(--fdShellBar_Branding_Border_Color, var(--sapButton_Lite_BorderColor));

    @include fd-hover() {
      --fdShellBar_Branding_Background: var(--fdShellbar_Branding_Hover_Background);
      --fdShellBar_Branding_Border_Color: var(--fdShellbar_Branding_Hover_Border_Color);
    }

    @include fd-active() {
      --fdShellBar_Branding_Background: var(--fdShellbar_Branding_Active_Background);
      --fdShellBar_Branding_Border_Color: var(--fdShellbar_Branding_Active_Border_Color);

      @include fd-focus() {
        outline: none;
      }
    }

    @include fd-focus() {
      outline-offset: -0.125rem;
      outline: var(--sapContent_FocusStyle) var(--sapContent_FocusWidth) var(--fdShellbar_Button_Outline_Color);
    }

    &--non-interactive {
      --fdShellBar_Branding_Cursor: auto;

      @include fd-hover() {
        --fdShellBar_Branding_Background: var(--sapButton_Lite_Background);
        --fdShellBar_Branding_Border_Color: var(--sapButton_Lite_BorderColor);
      }

      @include fd-active() {
        --fdShellBar_Branding_Background: var(--sapButton_Lite_Background);
        --fdShellBar_Branding_Border_Color: var(--sapButton_Lite_BorderColor);
      }

      @include fd-focus() {
        outline: none;
        
        --fdShellBar_Branding_Background: var(--sapButton_Lite_Background);
        --fdShellBar_Branding_Border_Color: var(--sapButton_Lite_BorderColor);
      }
    }
  }

  &__title {
    @include fd-reset();
    @include fd-ellipsis();

    font-size: var(--sapFontHeader5Size);
    color: var(--fdShellbar_Title_Color);
    font-family: var(--sapFontSemiboldFamily);
  }

  &__subtitle {
    @include fd-reset();
    @include fd-ellipsis();

    font-size: var(--sapFontSmallSize);
    color: var(--fdShellbar_Subtitle_Color)
  }

  &__product {
    @include fd-reset();
    @include fd-flex(column);
  }

  &__logo {
    @include fd-reset();

    height: 2rem;
    max-height: 2rem;
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin-inline: 0.25rem;
    margin-block: 0.0625rem;
    background-size: contain;
    background-repeat: no-repeat;

    > * {
      width: auto;
      display: block;
      line-height: 0;
      max-height: 2rem;
    }

    &--image-replaced {
      background-image: url(#{$fd-shellbar-logo-background-image-url});
      width: 3rem;
      height: 1.5rem;
    }
  }

  &__separator {
    @include fd-reset();

    width: 0.0625rem;
    height: 2rem;
    margin-inline: 0;
    margin-block: 0;
    background-color: var(--sapToolbar_SeparatorColor);
  }

  &__spacer {
    @include fd-reset();

    height: 100%;
    flex: 1 auto;
  }

  .#{$fd-namespace}-popover__control:focus-visible {
    outline: none;
  }

  .#{$block}__button {
    --fdButtonBackgroundColor: var(--sapButton_Lite_Background);
    --fdButtonBorderColor: var(--sapButton_Lite_BorderColor);
    --fdButtonColor: var(--sapShell_TextColor);

    & > [class*="sap-icon"] {
      color: var(--fdButtonIconColor, var(--sapShell_InteractiveTextColor));
    }

    &.#{$fd-namespace}-user-menu__control {
      padding-inline: 0;
    }

    @include fd-hover() {
      --fdButtonBackgroundColor: var(--sapShell_Hover_Background);
      --fdButtonBorderColor: var(--fdShellbar_Button_Hover_Border_Color);
      --fdButtonColor: var(--sapShell_TextColor);

      & > [class*="sap-icon"] {
        color: var(--fdButtonIconColor, var(--sapShell_InteractiveTextColor));
      }
    }

    @include fd-active() {
      --fdButtonBackgroundColor: var(--sapShell_Active_Background);
      --fdButtonBorderColor: var(--fdShellbar_Button_Active_Border_Color);
      --fdButtonColor: var(--sapShell_Active_TextColor);

      & > [class*="sap-icon"] {
        color: var(--fdButtonIconColor, var(--sapShell_Active_TextColor));
      }
    }

    @include fd-toggled() {
      --fdButtonBackgroundColor: var(--sapShell_Selected_Background);
      --fdButtonBorderColor: var(--fdShellbar_Button_Active_Border_Color);
      --fdButtonColor: var(--sapShell_Selected_TextColor);

      & > [class*="sap-icon"] {
        color: var(--fdButtonIconColor, var(--sapShell_Selected_TextColor));
      }
    }

    @include fd-focus() {
      &::after {
        border-color: var(--fdShellbar_Button_Outline_Color);
      }
    }

    &.#{$block}__button--menu {
      --fdButtonColor: var(--sapShell_TextColor);
    }

    &:has(.#{$block}__avatar--circle) {
      border-radius: 20rem;

      --fdButton_Height: fit-content;
      --fdButton_Clickable_Height: fit-content;
      --fdButton_Min_Width: fit-content;
      --fdButton_Focus_Border_Radius: 20rem;
    }

    &--menu {

      .#{$block}__title {
        margin-inline: 0;
        margin-block: 0;
      }
    }
  }

  .#{$block}__action {
    @include fd-reset();

    > * {
      vertical-align: middle;
    }

    &--grow {
      flex: 1;
    }

    &--shrink {
      flex: 0;
    }

    &:has(.#{$fd-namespace}-product-switch) {
      margin-inline-start: 0.5rem;
    }
  }

  .#{$block}__search-field {
    border: none;
    min-width: 25rem;
    max-width: 25rem;
    border-radius: var(--fdShellbar_SearchField_Border_Radius);
    box-shadow: var(--fdShellbar_SearchField_Box_Shadow, var(--fdShellbar_SearchField_Shadow));
    background-color: var(--fdShellbar_SearchField_Background_Color, var(--sapShell_InteractiveBackground));

    &:has(.#{$block}__search-field-category) {
      max-width: 36rem;
    }

    @include fd-hover() {
      --fdShellbar_SearchField_Box_Shadow: var(--sapField_Hover_Shadow);
      --fdShellbar_SearchField_Background_Color: var(--fdShellbar_SearchField_Background_Color_Hover);
    }

    @include fd-focus() {
      --fdShellbar_SearchField_Background_Color: var(--fdShellbar_SearchField_Background_Color_Active);

      outline: none;
    }

    @include fd-active() {
      --fdShellbar_SearchField_Background_Color: var(--fdShellbar_SearchField_Background_Color_Active);
    }

    &:has(input:focus) {
      --fdShellbar_SearchField_Background_Color: var(--fdShellbar_SearchField_Background_Color_Active);
      
      background: none;
      box-shadow: var(--fdShellbar_Active_Shadow);
    }

    &:has(button:hover) {
      --fdShellbar_SearchField_Background_Color: var(--sapShell_InteractiveBackground);
    }

    .#{$block}__search-field-input {
      width: 15rem;
      padding-inline: var(--fdInputGroup_Input_Padding, 0.875rem 0.25rem);
      border-radius: var(--fdShellbar_SearchField_Input_Border_Radius);
      
      &:placeholder-shown {
        & ~ .#{$block}__search-cancel {
          display: none;
        }
      }

      &::placeholder {
        color: var(--fdShellbar_SearchField_Input_Placeholder_TextColor);
      }

      --fdInputGroup_Input_Color: var(--fdShellbar_SearchField_Input_Text_Color);
      --fdInputGroup_Input_Border: var(--fdShellbar_SearchField_Input_Border);
      --fdInputGroup_Input_Background: var(--fdShellbar_SearchField_Input_Background_Regular);

      @include fd-hover() {
        --fdInputGroup_Hover_Input_Background: var(--fdShellbar_SearchField_Input_Background_Hover);
        --fdInputGroup_Input_Border: var(--fdShellbar_SearchField_Input_Border_Hover);

        border: var(--fdInputGroup_Input_Border);
      }

      @include fd-active() {
        --fdInputGroup_Input_Background: var(--fdShellbar_SearchField_Input_Background_Active);
        --fdInputGroup_Input_Border: var(--fdShellbar_SearchField_Input_Border_Active);
        --fdInputGroup_Input_Padding: var(--fdShellbar_SearchField_Input_Padding_Inline);
      }

      @include fd-focus() {
        --fdInputGroup_Input_Background: var(--fdShellbar_SearchField_Input_Background_Focus);
        --fdInputGroup_Input_Border: var(--fdShellbar_SearchField_Input_Border_Active);
        --fdInputGroup_Input_Padding: var(--fdShellbar_SearchField_Input_Padding_Inline);


        outline: var(--fdShellbar_SearchField_Input_Outline);
        outline-offset: var(--fdShellbar_SearchField_Input_Outline_Offset);
 
        &:not(:placeholder-shown) {
          & ~ .#{$block}__search-submit {
            > * {
              --fdButtonColor: var(--fdShellbar_SearchField_Submit_Button_Color);
              --fdButtonIconColor: var(--fdShellbar_SearchField_Submit_Button_Color);
              --fdButtonBorderColor: var(--fdShellbar_SearchField_Submit_Button_Border_Color);
              --fdButtonBackgroundColor: var(--fdShellbar_SearchField_Submit_Button_Background_Color);
  
              @include fd-hover() {
                --fdButtonColor: var(--sapButton_Emphasized_Hover_TextColor);
                --fdButtonIconColor: var(--sapButton_Emphasized_Hover_TextColor);
                --fdButtonBorderColor: var(--fdShellbar_SearchField_Submit_Button_Border_Color_Hover);
                --fdButtonBackgroundColor: var(--fdShellbar_SearchField_Submit_Button_Background_Color_Hover);
              }
            }
          }
        }
      }
    }

    .#{$block}__search-field-addon {
      @include fd-set-width(var(--fdShellbar_SearchField_Button_Width));

      margin-inline: var(--fdShellbar_SearchField_Addon_Margin_Inline);

      .#{$block}__button {
        @include fd-set-width(var(--fdShellbar_SearchField_Button_Width));
        @include fd-set-height(var(--fdShellbar_SearchField_Button_Height));

        --fdButton_Focus_Border_Radius: var(--fdShellbar_SearchField_Button_Border_Radius);
        
        border-radius: var(--fdShellbar_SearchField_Button_Border_Radius);

        @include fd-focus() {
          &::after {
            inset: var(--fdShellbar_SearchField_Button_Focus_Inset);
          }
        }
      }
    }

    .#{$block}__search-field-category {
      position: relative;
      margin-inline-end: var(--fdShell_Search_Field_Category_Margin_End);
      
      &::after {
        content: "";
        right: -0.5rem;
        height: 1.5rem;
        width: 0.0625rem;
        position: absolute;
        background-color: var(--sapShell_InteractiveBorderColor);
        display: var(--fdShell_Search_Field_Category_Divider_Display);
      }

      @include fd-rtl() {
        &::after {
          left: -0.5rem;
          right: auto;
        }
      }
    
      .#{$select} {
        margin-inline-start: 0.375rem;

        .#{$select}__control {
          &::after {
            box-shadow: none;
          }

          @include fd-focus() {
            outline: none;
          }
        }

        .#{$select}__text-content {
          color: var(--sapShell_InteractiveTextColor);
        }
      }

      .#{$block}__search-dropdown {
        @include fd-set-width(2.125rem);

        height: var(--fdShell_Search_Dropdown_Height);
        border-radius: var(--fdShell_Search_Dropdown_Button_Radius);
        color: var(--sapShell_InteractiveTextColor);

        & > [class*="sap-icon"] {
          @include fd-set-width(1rem);
        }

        @include fd-hover() {
          background-color: var(--sapShell_Hover_Background);
          color: var(--sapShell_InteractiveTextColor);
          box-shadow: var(--fdShell_Search_Dropdown_Box_Shadow_Hover);
        } 

        @include fd-active() {
          color: var(--sapShell_Active_TextColor);
        }
      }

      .#{$block}__search-category {
        gap: 0.25rem;
        background: none;
        max-width: 18rem;
        margin-inline: 0;
        min-width: auto;
        height: var(--fdShell_Search_Dropdown_Height);
        min-height: var(--fdShell_Search_Dropdown_Height);
        border-radius: var(--fdShell_Search_Dropdown_Border_Radius);
        border: var(--fdShell_Search_Category_Border);

        @include fd-hover() {
          background-color: var(--fdShell_Search_Dropdown_Hover_Background);
          box-shadow: var(--sapField_Hover_Shadow);
          border: var(--fdShell_Search_Category_Border);
        }

        @include fd-active() {
          background-color: var(--fdShell_Search_Dropdown_Active_Background);

          .#{$block}__search-dropdown {
            color: var(--sapShell_Active_TextColor);
            box-shadow: var(--fdShell_Search_Dropdown_Box_Shadow_Hover);
          }
        }

        @include fd-expanded() {
          background-color: var(--fdShell_Search_Dropdown_Active_Background);
          box-shadow: var(--sapField_Hover_Shadow);

          .#{$block}__search-dropdown {
            color: var(--sapShell_Active_TextColor);
            box-shadow: var(--fdShell_Search_Dropdown_Box_Shadow_Hover);
            background-color: var(--sapShell_Active_Background);
          }
        }

        &--collapsed {
          .#{$select}__text-content {
            display: none;
          }
        }
      }
    }
  }

  .#{$block}__group {
    --fdShellbar_Button_Active_Background: var(--sapShell_Active_Background);
    --fdShellbar_Button_Active_Color: var(--sapShell_Active_TextColor);

    @include fd-reset();

    @include fd-flex-vertical-center() {
      gap: 0.5rem;

      &--shrink {
        flex-grow: 0;
      }

      &--basis-auto {
        flex-basis: auto;
      }
    }

    &--product {
      order: 1;
      justify-content: flex-start;
    }

    &--copilot,
    &--center {
      order: 2;
      display: none;
      justify-content: center;
      margin-block: 0;
      margin-inline: 0.5rem;

      .#{$block}__action {
        width: 100%;
      }

      @include fd-media-xl() {
        display: inline-block;
      }
    }

    &--context-area {
      flex: 1;
      order: 2;
      gap: 0.5rem;
    }

    &--actions {
      justify-content: flex-end;
      order: 3;
      gap: 0.5rem;
    }

    &--full-width {
      width: 100%;
    }
  }

  .#{$block}__toolbar {
    padding-inline: 0;
  }

  &--s,
  &--sm {
    @include fd-shellbar-sm-screen();
  }

  &--m,
  &--l,
  &--md,
  &--lg {
    padding-block: 0;
    padding-inline: 2rem;
  }

  &--m,
  &--l,
  &--md,
  &--lg,
  &--xl {
    @include fd-shellbar-md-lg-xl-screens();
  }

  &--xl,
  &--xxl {
    padding-block: 0;
    padding-inline: 3rem;
  }

  &--side-nav {
    --fdShellbar_Inline_Padding: 0.875rem 1rem;
    
    &.#{$block}--s,
    &.#{$block}--m,
    &.#{$block}--l,
    &.#{$block}--sm,
    &.#{$block}--md,
    &.#{$block}--lg,
    &.#{$block}--xl {
      padding-inline: 0.875rem 1rem;
    }
  }

  &--responsive-paddings {
    @include fd-apply-responsive-paddings();

    @include fd-media-sm() {
      @include fd-shellbar-sm-screen();
    }

    @include fd-media-md() {
      @include fd-shellbar-md-lg-xl-screens();
    }

    @include fd-media-lg() {
      @include fd-shellbar-md-lg-xl-screens();
    }

    @include fd-media-xl() {
      @include fd-shellbar-md-lg-xl-screens();
    }
  }

  &-overlay {
    @include fd-reset();

    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    height: 100%;
    opacity: 0.3;
    position: absolute;
    background: var(--sapBlockLayer_Background);
  }

  @include fd-compact-or-condensed() {
    --fdShell_Search_Dropdown_Height: var(--sapElement_Compact_Height);
    --fdShellbar_SearchField_Button_Height: var(--sapElement_Compact_Height);
  }
}
